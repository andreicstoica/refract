flowchart LR
  subgraph Providers["App Providers"]
    direction TB
    Theme["ThemeProvider"]
    Timing["TimingConfigProvider"]
    Embeddings["EmbeddingsProvider"]
  end

  subgraph EditorHooks["TextInput Hooks"]
    direction TB
    EditorText["useEditorText"]
    TopicShift["useTopicShiftDetection"]
    SentenceTracker["useSentenceTracker"]
    ProdTriggers["useProdTriggers"]
    
    EditorText --> TopicShift
    EditorText --> SentenceTracker
    SentenceTracker --> ProdTriggers
  end
  
  subgraph QueueMgr["Prod Queue Manager"]
    direction TB
    Actions["useProdActions"]
    Queue["Queue<br/>guardrails + dedupe"]
    State["prods[] + pinnedIds"]
    
    Actions --> Queue
    Queue --> State
  end
  
  subgraph UI["UI Layer"]
    direction TB
    Chips["ChipOverlay"]
    Highlights["HighlightOverlay"]
    TextArea["Textarea DOM"]
  end
  
  Providers --> EditorHooks
  
  TopicShift -->|updateTopic| Actions
  TopicShift -.->|notifyShift| Actions
  ProdTriggers -->|enqueue| Actions
  
  Timing --> ProdTriggers
  Timing --> Queue
  
  State --> Chips
  State --> Highlights
  
  Chips --> TextArea
  Highlights --> TextArea
  
  Theme --> Highlights
  Embeddings --> EditorHooks
